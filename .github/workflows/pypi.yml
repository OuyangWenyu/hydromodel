# This workflows will upload a Python Package using uv and twine when a release is created

name: pypi

on:
    release:
        types: [published]

jobs:
    deploy:
        runs-on: ubuntu-latest
        permissions:
            id-token: write  # Required for trusted publishing
            contents: read
        steps:
            - uses: actions/checkout@v4
              with:
                fetch-depth: 0 # Required for hatch-vcs to get version from git tags

            - name: Install uv
              uses: astral-sh/setup-uv@v4
              with:
                version: "latest"

            - name: Setup Python
              run: uv python install 3.11

            # - name: Clean old uv caches
            #   run: |
            #       uv cache clean
            #       rm -rf .venv uv.lock

            - name: Install dependencies
              run: uv sync --all-extras # Install all dependencies including dev

            - name: Build package
              run: uv build

            - name: Publish to PyPI
              uses: pypa/gh-action-pypi-publish@release/v1
